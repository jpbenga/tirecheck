<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Tire Check POC</title>
    <style>
        body { font-family: sans-serif; text-align: center; padding: 40px; background: #f0f2f5; }
        .box { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); max-width: 400px; margin: auto; }
        img { max-width: 100%; margin: 20px 0; border-radius: 5px; display: none; }
        button { background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; }
        #res { margin-top: 20px; font-weight: bold; padding: 10px; border-radius: 4px; display: none; }
    </style>
</head>
<body>
    <div class="box">
        <h2>Scanner de Pneus</h2>
        <input type="file" id="inp" accept="image/*" onchange="show(this)">
        <img id="view">
        <button id="go" onclick="send()" disabled>Analyser</button>
        <div id="res"></div>
    </div>
    <script>
        const inp = document.getElementById('inp');
        const view = document.getElementById('view');
        const go = document.getElementById('go');
        const res = document.getElementById('res');

        function show(i) {
            if (i.files[0]) {
                view.src = URL.createObjectURL(i.files[0]);
                view.style.display = 'block';
                go.disabled = false;
            }
        }

        async function send() {
            const fd = new FormData();
            fd.append('image', inp.files[0]);
            go.innerText = "Calcul...";
            go.disabled = true;
            
            const r = await fetch('/analyze', { method: 'POST', body: fd });
            const d = await r.json();
            
            res.style.display = 'block';
            res.style.background = d.class === 'Good' ? '#d4edda' : '#f8d7da';
            res.innerText = `RÃ©sultat : ${d.class} (${(Math.max(d.confidence_defective, d.confidence_good)*100).toFixed(1)}%)`;
            go.innerText = "Analyser";
            go.disabled = false;
        }
    </script>
</body>
</html>